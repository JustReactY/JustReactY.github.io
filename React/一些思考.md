# 思考

1. react fiber

目的： 为了使react渲染的过程中可以被中断，可以将控制器重新交还给浏览器，可以让位给高优先级的任务，浏览器空闲后再恢复渲染
对于计算量比较大的js计算或者dom计算，就不会显得特别卡顿，而是一帧一帧的有规律的执行任务


``` js
const tasks = []

function run() {
    let task;
    while(task = tasks.shift()) {
        execute(task)
    }
}
```

generator

```js
const tasks = []

function * run() {
    let task;
    while(task = tasks.shift()) {
        if(hasHighPriorityTask()) {
            yield; // 中断
        }
        execute(task)
    }
}

const iterator = run()

iterator.next(); // 恢复

```

- generator 有类似功能，为什么不直接使用？

* 要使用 generator，需要将涉及到的所有代码都包装成generator * 的形式，非常麻烦，工作量大
* generator 内部是有状态的


```js 
function * doWork(a, b, c) {
    const x = doExpendsiveWorkA(a);
    yield;
    const y = doExpendsiveWorkB(b);
    yield;
    const z = doExpendsiveWorkC(c);
    return z
}
```

我们已经执行完了 doExpendsiveWorkA 和 doExpendsiveWorkB，还未执行 doExpendsiveWorkC，
如果此时b更新了，那么在新的时间分片里，我们只能沿用之前获取到的x，y结果

- 如何判断当前是否有高优任务呢？

当前js环境其实并没有办法去判断是否有高优任务

只能约定一个合理的执行时间，当超过了这个执行时间，如果任务仍然没有执行完成，中断当前任务，将控制权交还给浏览器

每秒60帧， 1000ms/60f = 16ms

浏览器提供了 requestIdleCallback 使浏览器在空闲状态执行回调，这个回调会传入一个参数，表示浏览器有多少时间分配给我们执行任务

* 浏览器在一帧内要做什么事情

处理用户输入事件
JS执行
requestIdleCallback 调用
布局 layout
绘制 paint

* 浏览器很忙怎么办？

requestIdleCallback timeout参数， 100ms，
如果超过timeout后还没有被执行，会在下一帧强制执行回调

* 兼容性如何？
requestIdleCallback 兼容性很差， 通过messageChanner 模拟实现了 requestIdleCallback的功能


* timeout超时后就一定要被执行么

不是的 react 里面预订了5个优先级的等级

Immediate 最高优先级，要被马上执行不能中断
UserBlocking 一般是用户交互的结果，需要即使得到反馈
Normal 不需要用户立即就感受到的变化，比如网络请求
Low 这些任务可以延后 但是最终也是需要执行的
Idle 可以被无限期延后


2. 平时用过高阶组件么？什么是高阶组件？高阶组件能用来做什么？
简称HOC ， Hige Order Components

- 一个函数
- 入参：原来的react组件
- 返回值：新的react组件
- 是一个纯函数，不应该有任何的副作用




































